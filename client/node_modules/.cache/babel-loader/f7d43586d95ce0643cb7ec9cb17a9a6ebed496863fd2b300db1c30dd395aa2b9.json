{"ast":null,"code":"import React,{useEffect}from'react';import{useNavigate,useSearchParams}from'react-router-dom';import{useDispatch}from'react-redux';import{setCredentials}from'../store/slices/authSlice';import LoadingSpinner from'../components/ui/LoadingSpinner';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const GoogleCallbackPage=()=>{const[searchParams]=useSearchParams();const navigate=useNavigate();const dispatch=useDispatch();useEffect(()=>{const token=searchParams.get('token');const error=searchParams.get('error');if(error){toast.error('Google authentication failed. Please try again.');navigate('/login');return;}if(token){// Store token in localStorage\nlocalStorage.setItem('token',token);// Fetch user data with the token\nconst fetchUserData=async()=>{try{const API_BASE_URL=process.env.NODE_ENV==='production'?process.env.REACT_APP_API_URL||'https://your-backend.railway.app':'http://localhost:5001';const response=await fetch(\"\".concat(API_BASE_URL,\"/api/auth/me\"),{headers:{'Authorization':\"Bearer \".concat(token)}});if(response.ok){const data=await response.json();dispatch(setCredentials({user:data.user,token}));toast.success('Successfully signed in with Google!');navigate('/');}else{throw new Error('Failed to fetch user data');}}catch(error){console.error('Error fetching user data:',error);toast.error('Authentication failed. Please try again.');navigate('/login');}};fetchUserData();}else{toast.error('Authentication failed. Please try again.');navigate('/login');}},[searchParams,navigate,dispatch]);return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(LoadingSpinner,{size:\"xl\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Completing Google sign-in...\"})]})});};export default GoogleCallbackPage;","map":{"version":3,"names":["React","useEffect","useNavigate","useSearchParams","useDispatch","setCredentials","LoadingSpinner","toast","jsx","_jsx","jsxs","_jsxs","GoogleCallbackPage","searchParams","navigate","dispatch","token","get","error","localStorage","setItem","fetchUserData","API_BASE_URL","process","env","NODE_ENV","REACT_APP_API_URL","response","fetch","concat","headers","ok","data","json","user","success","Error","console","className","children","size"],"sources":["/Users/adityapandey/Desktop/HarshKumar/client/src/pages/GoogleCallbackPage.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useDispatch } from 'react-redux';\nimport { setCredentials } from '../store/slices/authSlice';\nimport LoadingSpinner from '../components/ui/LoadingSpinner';\nimport toast from 'react-hot-toast';\n\nconst GoogleCallbackPage = () => {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const token = searchParams.get('token');\n    const error = searchParams.get('error');\n\n    if (error) {\n      toast.error('Google authentication failed. Please try again.');\n      navigate('/login');\n      return;\n    }\n\n    if (token) {\n      // Store token in localStorage\n      localStorage.setItem('token', token);\n      \n      // Fetch user data with the token\n      const fetchUserData = async () => {\n        try {\n          const API_BASE_URL = process.env.NODE_ENV === 'production' \n            ? process.env.REACT_APP_API_URL || 'https://your-backend.railway.app'\n            : 'http://localhost:5001';\n          const response = await fetch(`${API_BASE_URL}/api/auth/me`, {\n            headers: {\n              'Authorization': `Bearer ${token}`\n            }\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            dispatch(setCredentials({ user: data.user, token }));\n            toast.success('Successfully signed in with Google!');\n            navigate('/');\n          } else {\n            throw new Error('Failed to fetch user data');\n          }\n        } catch (error) {\n          console.error('Error fetching user data:', error);\n          toast.error('Authentication failed. Please try again.');\n          navigate('/login');\n        }\n      };\n\n      fetchUserData();\n    } else {\n      toast.error('Authentication failed. Please try again.');\n      navigate('/login');\n    }\n  }, [searchParams, navigate, dispatch]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"text-center\">\n        <LoadingSpinner size=\"xl\" />\n        <p className=\"mt-4 text-gray-600\">Completing Google sign-in...</p>\n      </div>\n    </div>\n  );\n};\n\nexport default GoogleCallbackPage;\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,WAAW,CAAEC,eAAe,KAAQ,kBAAkB,CAC/D,OAASC,WAAW,KAAQ,aAAa,CACzC,OAASC,cAAc,KAAQ,2BAA2B,CAC1D,MAAO,CAAAC,cAAc,KAAM,iCAAiC,CAC5D,MAAO,CAAAC,KAAK,KAAM,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEpC,KAAM,CAAAC,kBAAkB,CAAGA,CAAA,GAAM,CAC/B,KAAM,CAACC,YAAY,CAAC,CAAGV,eAAe,CAAC,CAAC,CACxC,KAAM,CAAAW,QAAQ,CAAGZ,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAa,QAAQ,CAAGX,WAAW,CAAC,CAAC,CAE9BH,SAAS,CAAC,IAAM,CACd,KAAM,CAAAe,KAAK,CAAGH,YAAY,CAACI,GAAG,CAAC,OAAO,CAAC,CACvC,KAAM,CAAAC,KAAK,CAAGL,YAAY,CAACI,GAAG,CAAC,OAAO,CAAC,CAEvC,GAAIC,KAAK,CAAE,CACTX,KAAK,CAACW,KAAK,CAAC,iDAAiD,CAAC,CAC9DJ,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CAEA,GAAIE,KAAK,CAAE,CACT;AACAG,YAAY,CAACC,OAAO,CAAC,OAAO,CAAEJ,KAAK,CAAC,CAEpC;AACA,KAAM,CAAAK,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACF,KAAM,CAAAC,YAAY,CAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,GAAK,YAAY,CACtDF,OAAO,CAACC,GAAG,CAACE,iBAAiB,EAAI,kCAAkC,CACnE,uBAAuB,CAC3B,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIP,YAAY,iBAAgB,CAC1DQ,OAAO,CAAE,CACP,eAAe,WAAAD,MAAA,CAAYb,KAAK,CAClC,CACF,CAAC,CAAC,CAEF,GAAIW,QAAQ,CAACI,EAAE,CAAE,CACf,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAL,QAAQ,CAACM,IAAI,CAAC,CAAC,CAClClB,QAAQ,CAACV,cAAc,CAAC,CAAE6B,IAAI,CAAEF,IAAI,CAACE,IAAI,CAAElB,KAAM,CAAC,CAAC,CAAC,CACpDT,KAAK,CAAC4B,OAAO,CAAC,qCAAqC,CAAC,CACpDrB,QAAQ,CAAC,GAAG,CAAC,CACf,CAAC,IAAM,CACL,KAAM,IAAI,CAAAsB,KAAK,CAAC,2BAA2B,CAAC,CAC9C,CACF,CAAE,MAAOlB,KAAK,CAAE,CACdmB,OAAO,CAACnB,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACjDX,KAAK,CAACW,KAAK,CAAC,0CAA0C,CAAC,CACvDJ,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAEDO,aAAa,CAAC,CAAC,CACjB,CAAC,IAAM,CACLd,KAAK,CAACW,KAAK,CAAC,0CAA0C,CAAC,CACvDJ,QAAQ,CAAC,QAAQ,CAAC,CACpB,CACF,CAAC,CAAE,CAACD,YAAY,CAAEC,QAAQ,CAAEC,QAAQ,CAAC,CAAC,CAEtC,mBACEN,IAAA,QAAK6B,SAAS,CAAC,0DAA0D,CAAAC,QAAA,cACvE5B,KAAA,QAAK2B,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1B9B,IAAA,CAACH,cAAc,EAACkC,IAAI,CAAC,IAAI,CAAE,CAAC,cAC5B/B,IAAA,MAAG6B,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CAAC,8BAA4B,CAAG,CAAC,EAC/D,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAA3B,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}